
# 🔑 Identity System with AuthMe

AuthMe already manages your **Minecraft authentication** (`username`, `password`, `email`, `uuid`).  
We’ll extend it slightly so it also works for **Discord** and **Website/Backend**.

---

## 1. 🔎 Database Schema

AuthMe has a table like `authme` (depending on config).  
Typical columns are:

|Column|Type|Notes|
|---|---|---|
|id|INT (PK)|Unique row|
|username|VARCHAR|Minecraft username|
|realname|VARCHAR|Case-correct name|
|password|VARCHAR|Hashed password|
|email|VARCHAR|Optional|
|uuid|VARCHAR|MC UUID|
|isLogged|TINYINT|AuthMe session info|
|…|…|Other AuthMe internals|

👉 Add new columns for cross-platform identity:

|Column|Type|Notes|
|---|---|---|
|discord_id|BIGINT|Discord user snowflake (linked after `/verify`)|
|jwt_secret|VARCHAR|(optional) per-user JWT secret, or use global|
|created_at|TIMESTAMP|audit field|
|updated_at|TIMESTAMP|audit field|

That way, all systems resolve back to **one row in the `authme` table**.

---

## 2. 🔄 Access Flows

### 🔹 Minecraft → Backend

- Player logs into server → AuthMe validates credentials.
    
- Your plugin calls backend using a **JWT**, signed by backend after checking AuthMe DB.
    
- Backend sees: `sub: Steve123` → initiative created by `Steve123`.
    

✅ No password ever leaves Minecraft → just JWT tokens.

---

### 🔹 Website → Backend

- Login form (`username` + `password`) → backend checks against `authme.password` hash.
    
- If valid → backend issues JWT (stored in cookie or localStorage).
    
- JWT again includes `sub: Steve123`.
    
- Any initiative created goes under the same `authme` row.
    

✅ Web login reuses **AuthMe DB directly**.

---

### 🔹 Discord Bot → Backend

- User verifies with `/verify` (plugin gives code → user pastes in Discord → bot sends to backend → backend updates `authme.discord_id`).
    
- When user runs `/initiative` in Discord:
    
    - Bot sends request to backend with **bot token** + `X-Discord-User: 12345`.
        
    - Backend looks up `discord_id → Steve123`.
        
    - Stores initiative as created by `Steve123`.
        

✅ Discord never needs a password, only linked identity.

---

## 3. 🔐 Request Formats

All requests converge into **one `/initiatives` route**:

### Minecraft / Web

`POST /initiatives Authorization: Bearer <JWT> Content-Type: application/json  {   "title": "Ban Creepers",   "description": "Too destructive!" }`

### Discord Bot

`POST /initiatives Authorization: Bot <BOT_API_KEY> X-Discord-User: 123456789012345678 Content-Type: application/json  {   "title": "Protect Villagers",   "description": "Stop raids" }`

---

## 4. 🏗 Backend Middleware

One unified middleware:

1. If `Authorization: Bearer` → validate JWT → `minecraft_username` from payload.
    
2. If `Authorization: Bot` → validate bot key → use `X-Discord-User` → lookup `discord_id` in AuthMe DB → resolve `minecraft_username`.
    
3. Attach `req.user = { username: "Steve123", uuid: "...", discord_id: "..." }`.
    

Now your business logic doesn’t care about **source** — it always sees the player identity.

---

## 5. ✅ Benefits

- **One DB** (AuthMe) = single source of truth.
    
- **Extensible** — adding more integrations just means adding columns.
    
- **Unified routes** — `/initiatives` works for all.
    
- **Clean user experience** — no extra accounts, just Minecraft + optional Discord link.