# 3.4 Wechsel von PaperMC zu Folia

## Hintergrund
Unser HelvetiCraft-Server lief ursprünglich auf **PaperMC**, einer stabilen und weit verbreiteten Minecraft-Server-Software, die viele Optimierungen und API-Erweiterungen bietet. Während PaperMC für normale Server gut geeignet ist, stiessen wir bei unserem Setup auf **Leistungsengpässe**, insbesondere beim Laden von Chunks und bei der Verwaltung von Entitäten, als wir den Server auf einem **Raspberry Pi 5 mit 16 GB RAM** betrieben.

## Problemstellung
Auf dem Raspberry Pi traten folgende Einschränkungen auf:

- **Chunk-Generierung und -Laden**: Längere Ladezeiten beim Betreten neuer Gebiete.
- **Entity-Handling**: Spürbare Verzögerungen bei vielen gleichzeitig aktiven Entitäten.
- **CPU-Auslastung**: PaperMC nutzt hauptsächlich den Haupt-Thread, was auf Single-Core- oder ARM-basierten Systemen wie dem Raspberry Pi zu Flaschenhälsen führt.

Da unser Server Ziel war, **rund 20 Spieler gleichzeitig** performant zu bedienen, mussten wir nach einer Lösung suchen, die **bessere Thread-Nutzung** erlaubt und die CPU effizienter auslastet.

## Folia als Lösung
**Folia** ist ein Fork von PaperMC, der **echtes Multithreading** unterstützt:

- **Thread-Safe Scheduling**: Aufgaben, die zuvor nur synchron im Haupt-Thread laufen konnten, können nun sicher auf mehreren Threads ausgeführt werden.
- **Optimierte Chunk-Verwaltung**: Chunks können parallel geladen und generiert werden, wodurch Ladezeiten spürbar reduziert werden.
- **Bessere Entity-Verwaltung**: Mehrere Entitäten können gleichzeitig verarbeitet werden, ohne den Haupt-Thread zu blockieren.

Die Umstellung auf Folia ermöglicht somit, dass unser Server **gleichbleibend flüssig läuft**, selbst wenn mehrere Spieler gleichzeitig Aktionen ausführen oder neue Gebiete betreten.

## Technische Anpassungen
Um Folia nutzen zu können, mussten folgende Punkte beachtet werden:

1. **Scheduler-Anpassungen**  
   Alle `BukkitScheduler.runTask(...)` und `runTaskTimer(...)` Aufrufe mussten auf **SafeScheduler-kompatible Methoden** angepasst werden, um **Thread-Safety** zu gewährleisten.

2. **Plugin-Kompatibilität**  
   Unsere bestehenden PaperMC-Plugins wurden grösstenteils übernommen.  
   - Keine tiefgreifenden Änderungen notwendig, da die API weitgehend kompatibel ist.  
   - Spezifische Scheduler-Aufrufe wurden angepasst.  

3. **Abhängigkeiten**  
   Wir haben darauf verzichtet, die Folia-API direkt als Maven-Dependency einzubinden, da unser Plugin auch weiterhin auf **PaperMC laufen soll**.

## Fazit
Die Umstellung auf Folia wurde aus **Leistungsgründen** durchgeführt:

- Reduzierung von **Chunk-Ladezeiten**.
- Bessere **Entity-Verarbeitung** bei gleichzeitigen Spielern.
- Effiziente **CPU-Auslastung** auf dem Raspberry Pi 5.
- Vorbereitung auf **zukünftige Erweiterungen** mit multithreaded Prozessen.

Mit Folia läuft der Server nun stabil und performant für unsere Zielgruppe von etwa 20 gleichzeitigen Spielern, während unsere Plugins weiterhin kompatibel bleiben.
